{
  "info": {
    "_postman_id": "2a3a41ea-bcaa-4b42-9fc8-6b8a8bb52df8",
    "name": "AI Trip Assistant Booking Workflow",
    "description": "Collection covering BFF and booking service endpoints for itinerary quotes and confirmations.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "BFF API",
      "item": [
        {
          "name": "Quote Single Product",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"product_type\": \"hotel\",\n  \"currency\": \"JPY\",\n  \"party_size\": 2,\n  \"params\": {\n    \"city\": \"Tokyo\",\n    \"check_in\": \"2025-11-02\",\n    \"check_out\": \"2025-11-05\",\n    \"room_type\": \"twin\"\n  }\n}"
            },
            "url": {
              "raw": "{{bff_base_url}}/api/booking/quote",
              "host": [
                "{{bff_base_url}}"
              ],
              "path": [
                "api",
                "booking",
                "quote"
              ]
            },
            "description": "Requests a single-product quote via the BFF. Response contains a signed quote token."
          },
          "response": []
        },
        {
          "name": "Quote Itinerary",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"itinerary_id\": \"iti_tokyo_2025\",\n  \"currency\": \"JPY\",\n  \"items\": [\n    {\n      \"reference\": \"hotel_tokyo_nov02\",\n      \"product_type\": \"hotel\",\n      \"party_size\": 2,\n      \"params\": {\n        \"city\": \"Tokyo\",\n        \"check_in\": \"2025-11-02\",\n        \"check_out\": \"2025-11-05\",\n        \"room_type\": \"twin\"\n      }\n    },\n    {\n      \"reference\": \"narita_transfer\",\n      \"product_type\": \"transport\",\n      \"party_size\": 2,\n      \"params\": {\n        \"mode\": \"train\",\n        \"from\": \"NRT\",\n        \"to\": \"Shinjuku\",\n        \"date\": \"2025-11-02\"\n      }\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{bff_base_url}}/api/booking/itinerary/quote",
              "host": [
                "{{bff_base_url}}"
              ],
              "path": [
                "api",
                "booking",
                "itinerary",
                "quote"
              ]
            },
            "description": "Generates a bundle quote for an itinerary. Response bundle token can be confirmed fully or partially."
          },
          "response": []
        },
        {
          "name": "Confirm Single Product",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Idempotency-Key",
                "value": "{{idempotency_key}}",
                "description": "Optional: ensure safe retries."
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"quote_token\": \"{{single_quote_token}}\",\n  \"payment_token\": \"pm_mock_4242\"\n}"
            },
            "url": {
              "raw": "{{bff_base_url}}/api/booking/confirm",
              "host": [
                "{{bff_base_url}}"
              ],
              "path": [
                "api",
                "booking",
                "confirm"
              ]
            },
            "description": "Confirms a single-product quote. Paste the token returned by the quote request into the `single_quote_token` variable."
          },
          "response": []
        },
        {
          "name": "Confirm Itinerary (Full Bundle)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Idempotency-Key",
                "value": "{{idempotency_key}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"quote_token\": \"{{itinerary_quote_token}}\",\n  \"payment_token\": \"pm_mock_4242\"\n}"
            },
            "url": {
              "raw": "{{bff_base_url}}/api/booking/confirm",
              "host": [
                "{{bff_base_url}}"
              ],
              "path": [
                "api",
                "booking",
                "confirm"
              ]
            },
            "description": "Confirms every item in the itinerary quote. Leave `item_refs` out (or empty array) to book everything."
          },
          "response": []
        },
        {
          "name": "Confirm Itinerary (Subset)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Idempotency-Key",
                "value": "{{idempotency_key}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"quote_token\": \"{{itinerary_quote_token}}\",\n  \"payment_token\": \"pm_mock_4242\",\n  \"item_refs\": [\n    \"hotel_tokyo_nov02\"\n  ]\n}"
            },
            "url": {
              "raw": "{{bff_base_url}}/api/booking/confirm",
              "host": [
                "{{bff_base_url}}"
              ],
              "path": [
                "api",
                "booking",
                "confirm"
              ]
            },
            "description": "Confirms only selected itinerary items. Adjust `item_refs` to match references from the quote response."
          },
          "response": []
        }
      ]
    },
    {
      "name": "Booking Service (Direct)",
      "item": [
        {
          "name": "Service Quote Single Product",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"product_type\": \"transport\",\n  \"currency\": \"JPY\",\n  \"party_size\": 2,\n  \"params\": {\n    \"mode\": \"train\",\n    \"from\": \"NRT\",\n    \"to\": \"Shinjuku\",\n    \"date\": \"2025-11-02\"\n  }\n}"
            },
              "url": {
              "raw": "{{booking_service_base_url}}/api/booking/quote",
              "host": [
                "{{booking_service_base_url}}"
              ],
              "path": [
                "api",
                "booking",
                "quote"
              ]
            },
            "description": "Direct call to the booking service quote endpoint (no auth)."
          },
          "response": []
        },
        {
          "name": "Service Quote Itinerary",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"itinerary_id\": \"iti_tokyo_2025\",\n  \"currency\": \"JPY\",\n  \"items\": [\n    {\n      \"reference\": \"attraction_day1\",\n      \"product_type\": \"attraction\",\n      \"party_size\": 2,\n      \"params\": {\n        \"city\": \"Tokyo\",\n        \"name\": \"teamLab Planets\",\n        \"date\": \"2025-11-03\",\n        \"session\": \"10:00\"\n      }\n    },\n    {\n      \"reference\": \"hotel_tokyo_nov02\",\n      \"product_type\": \"hotel\",\n      \"party_size\": 2,\n      \"params\": {\n        \"city\": \"Tokyo\",\n        \"check_in\": \"2025-11-02\",\n        \"check_out\": \"2025-11-05\",\n        \"room_type\": \"twin\"\n      }\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{booking_service_base_url}}/api/booking/itinerary/quote",
              "host": [
                "{{booking_service_base_url}}"
              ],
              "path": [
                "api",
                "booking",
                "itinerary",
                "quote"
              ]
            },
            "description": "Direct itinerary quote on the booking service."
          },
          "response": []
        },
        {
          "name": "Service Confirm",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Idempotency-Key",
                "value": "{{idempotency_key}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"quote_token\": \"{{service_quote_token}}\",\n  \"payment_token\": \"pm_mock_4242\",\n  \"item_refs\": []\n}"
            },
            "url": {
              "raw": "{{booking_service_base_url}}/api/booking/confirm",
              "host": [
                "{{booking_service_base_url}}"
              ],
              "path": [
                "api",
                "booking",
                "confirm"
              ]
            },
            "description": "Confirm a quote directly against the booking service. Provide `item_refs` only for itinerary tokens."
          },
          "response": []
        }
      ]
    }
  ],
  "event": [],
  "variable": [
    {
      "key": "bff_base_url",
      "value": "http://localhost:8092",
      "type": "string"
    },
    {
      "key": "booking_service_base_url",
      "value": "http://localhost:8092",
      "type": "string"
    },
    {
      "key": "jwt_token",
      "value": "",
      "type": "string"
    },
    {
      "key": "idempotency_key",
      "value": "",
      "type": "string",
      "description": "Optional UUID for safe retries (leave blank or set per request)."
    },
    {
      "key": "single_quote_token",
      "value": "",
      "type": "string"
    },
    {
      "key": "itinerary_quote_token",
      "value": "",
      "type": "string"
    },
    {
      "key": "service_quote_token",
      "value": "",
      "type": "string"
    }
  ]
}
